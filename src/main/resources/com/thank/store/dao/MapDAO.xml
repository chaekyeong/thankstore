<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		
		
<mapper namespace="com.thank.store.dao.MapDAO">

	<select id="getTotalCvStore" resultType="CvStoreDTO">
		select storecode, name,latitude,longitude,address,brand
		from cvstore
	</select>

	
	<select id="getCvStore"  parameterType="hashmap" resultType="CvStoreDTO">
		<![CDATA[
			select name, address, brand, latitude, longitude, storecode
			FROM(
			    SELECT 
			    (( ACOS(
			    SIN((#{lat}-0.019) * 3.14 / 180) * 
			    SIN((Latitude-0.019) * 3.14 / 180) + 
			    COS((#{lat}-0.019) * 3.14 / 180) * 
			    COS((Latitude-0.019) * 3.14 / 180) * 
			    COS(((#{lon}-0.022) - (Longitude-0.022)) * 3.14 / 180)) * 
			    180 / 3.14) * 60 * 1.1515) AS distance, name, address, brand,latitude,longitude,storecode
			    FROM cvstore
			    order by distance
			    )
			where rownum<=50
		]]>
	</select>
	
	
	<select id="getProductList"  parameterType="hashmap" resultType="ProductListDTO">
		<![CDATA[
			select p.name, p.imgurl, p.price, cvs.storecode
			from cvstore cvs
				join cvstoreproduct cvsp 
				  on    cvs.no = cvsp.cvstore_no
				join productlist p 
				  on cvsp.productlist_no = p.no
			where cvs.storecode = #{storecode}
		]]>
	</select>
</mapper>